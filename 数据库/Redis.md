# 1 NoSQL 概述



## 1.1 为什么使用？

> 1. 单机模型

最早的单机服务器上，我们只需要使用单个的数据库就够使用了。毕竟用户的访问量没有那么大。



> 2. Memcached（缓存）+ MySQL + 垂直拆分

- 网站80%的请求都是读，每次都要取数据库中查询的话效率太低了。

- 为了减少服务器的压力，我们就可以使用缓存来保证效率。

    ![image-20200628192246257](Redis.assets/image-20200628192246257.png)

    

- 发展过程：优化数据结构和索引 ==》文件缓存（IO）==》Memcached

缓存技术主要是来解决**读**的问题。



> 3. 水平拆分 分库分表 MySQL集群



> 为什么要用？

- 数据量增长的速度非常快，单单用关系型数据库很难处理。
- MySQL来存储些比较大的文件，博客，图片时，效率不高。需要依赖另一种专门处理的数据库。



## 1.2 什么是NoSQL

很多的数据类型：用户的个人信息，社交网络，地理信息等。这些数据类型的存储不需要一个固定的格式。不需要多余的操作就可以横向扩展的。 就像 Map <String, Object>

> NoSQL 特点

​	**解耦！**

1. 方便扩展：数据之间没有关系，很容易扩展。

2. 大数据量高性能：Redis 一秒写8W，读取11W。NoSQL的缓存记录级，是一种细粒度的缓存。

3. 数据类型是多样性的：不需要事先设计数据库。随去随用。如果是数据量大的表，一开始很难设计好。

4. 传统RDBMS和NoSQL

    ```yaml
    传统RDBMS
    - 结构化组织
    - SQL 语言
    - 数据和关系都存在单独的表中
    - 操作，数据定义语言
    - 严格的一致性
    - 基础的事务
    ```

    ```
    NoSQL
    - 不仅仅是数据
    - 没有固定的查询语言
    - 从多种存储方式：键值对存储，列存储，文档存储，图形数据库
    - 最终一致性，保证最终一致就可以
    - CAP定理 和 BASE
    - 高性能，高可用，高可扩展
    ```

    

> 了解：3V+3高

- 大数据的3V：用来描述问题；
    - 海量Volume
    - 多样Variety
    - 实时Velocity
- 3高需求：
    - 高并发
    - 高可扩 （随时水平拆分，+服务器）
    - 高性能

最佳实践：NoSQL + RDBMS。





# 架构演进（阿里）



**一、 商品的各种数据信息**

```bash
# 1、商品的基本信息
	名称、价格、商家信息
	关系型数据库就可以解决。 MySQL / Oracle
	淘宝内部的MySQL不是大家用的MySQL
	
	
# 2、商品的描述、评论（文字比较多）
	文档型数据库：MongoDB

# 3、图片
	分布式文件系统 FastDFS
	- 淘宝自己的 TFS
	- Hadoop   HDFS
	- 阿里云    oss
	
# 4、商品的关键字（搜索）
	- 搜索引擎 solr elasticsearch
	
# 5、商品热门的波段信息
	- 内存数据库
	- Redis Tair、Memcache
	
# 6、商品的交易，外部的支付接口
	- 三方应用
```



**二、大型互联网中的问题**

- 数据类型太多了
- 数据源繁多，经常重构
- 数据要改造的话，大面积改造？

解决办法：统一数据服务层框架缓存模块 UDSL

> 在网站APP与各种数据库相关底层中间加上一层统一的数据处理层。屏蔽底层细节。方便程序员编程。
>
> 程序员不需要去了解每一个底层数据库或者搜索引擎的具体细节。只要用一个统一的接口操作一切就可以。



# NoSQL的四种类型



**KV键值对**：

- 新浪：Redis
- 美团：Redis+Tair
- 阿里、百度：Redis——memcache



**文档型数据库（bson格式）**：

- MongoDB（一般必须要掌握）
    - MongoDB是一个基于分布式文件存储的数据库，C++编写，主要用来处理大量的文档。
    - MongoDB是一个介于关系型数据库和NoSQL之间的一种产品。MongoDB是非关系型数据库中功能最丰富，最像关系型数据的。
- CouchDB



**列存储的数据库**：

- HBase
- 分布式文件系统



**图数据库**：

- neo4j





# Redis 入门

## 概述

> Redis = Remote Dictionary Server 远程字典服务

Redis 是 开源、C语言编写、支持网络、可基于内存、可持久化、K-V数据库，提供多种语言API。 

Redis支持各种不同方式的排序。与memcached一样，为了保证效率，数据都是缓存在内存中。区别的是redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了master-slave(主从)同步。



> Redis 能干嘛？

1、内存存储、持久化。持久化就聊 rdb和aof。

2、效率高，可以用于高速缓存。

3、发布订阅系统

4、地图信息分析

5、计时器、计数器（微信浏览量）

6、.....



> 特性

1、多样化数据类型

2、持久化

3、集群

4、事务



> 





## Linux 安装

1. 下载redis-6.0.x.tar.gz

2. ```bash
    tar -zxvf redis-.tar.gz
    cd redis-.tar.gz
    ```

3. ```bash
    # make
    # 安装在/usr/local/bin
    make
    make install
    ```

查看：![image-20200715230923500](Redis.assets/image-20200715230923500.png)

4. 拷贝解压包下的redis.conf到 /usr/local/bin/redisconfig

> 我们以后就修改这个配置文件进行启动。

5. redis不是默认后台启动的，修改配置文件。

    ![image-20200715231357151](Redis.assets/image-20200715231357151.png)



6. 启动redis服务：通过配置文件启动 redis-server

![image-20200715231530305](Redis.assets/image-20200715231530305.png)

7. 测试连接：使用redis-cli 指定端口号 （-h 指定host ip）

    ![image-20200715231759249](Redis.assets/image-20200715231759249.png)

8. 退出redis服务：server & cli

    ![image-20200715232000780](Redis.assets/image-20200715232000780.png)

    9.后续使用单机多port的集群方式。